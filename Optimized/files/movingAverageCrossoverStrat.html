<html><head><style>
    body { background-color: black; color: white; }
    .keyword { color: goldenrod; font-weight: bold; }
    .special { color: lightpink; }
    .variable { color: lightblue; }
    .operator { color: white; }
    .number { color: lightgreen; }
    .comment { color: green; font-style: italic; }
    .string { color: lightcoral; }
    .punctuation { color: yellow; }
    .error { text-decoration: underline wavy red; color: red; }
    pre { white-space: pre-wrap; } /* Preserva espacios y saltos de l√≠nea */
    </style></head><body><pre><span class="keyword">import</span>&nbsp;<span class="variable">yfinance</span>&nbsp;<span class="keyword">as</span>&nbsp;<span class="variable">yf</span><br><span class="keyword">import</span>&nbsp;<span class="error">matplotlib</span><span class="variable">pyplot</span>&nbsp;<span class="keyword">as</span>&nbsp;<span class="variable">plt</span><br><span class="keyword">import</span>&nbsp;<span class="variable">numpy</span>&nbsp;<span class="keyword">as</span>&nbsp;<span class="variable">np</span><br><br><br><span class="comment"># Params</span><br><span class="variable">TICKER</span>&nbsp;<span class="operator">=</span>&nbsp;<span class="string">'SPY'</span><br><span class="variable">FAST</span>&nbsp;<span class="operator">=</span>&nbsp;<span class="number">10</span><br><span class="variable">SLOW</span>&nbsp;<span class="operator">=</span>&nbsp;<span class="number">27</span><br><span class="variable">LOOKBACK</span>&nbsp;<span class="operator">=</span>&nbsp;<span class="number">60</span>&nbsp;<span class="comment"># periods, max available</span><br><br><br><span class="keyword">def</span>&nbsp;<span class="variable">getData</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="variable">df</span>&nbsp;<span class="operator">=</span>&nbsp;<span class="error">yf</span><span class="variable">download</span><span class="punctuation">(</span><span class="variable">TICKER</span><span class="punctuation">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="error">df</span><span class="variable">columns</span>&nbsp;<span class="operator">=</span>&nbsp;<span class="error">df</span><span class="error">columns</span><span class="variable">get_level_values</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="error">df</span><span class="variable">iloc</span><span class="punctuation">[</span><span class="operator">-</span><span class="variable">LOOKBACK</span><span class="punctuation">:</span><span class="punctuation">,</span><span class="punctuation">:</span><span class="punctuation">]</span><br><br><br><span class="comment"># What do we want our strat to be</span><br><br><span class="keyword">def</span>&nbsp;<span class="variable">addMovingAverages</span><span class="punctuation">(</span><span class="variable">df</span><span class="punctuation">,</span>&nbsp;<span class="variable">fast</span><span class="punctuation">,</span>&nbsp;<span class="variable">slow</span><span class="punctuation">)</span><span class="punctuation">:</span>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="variable">df</span><span class="punctuation">[</span><span class="error">f</span><span class="punctuation">{</span><span class="variable">FAST</span><span class="punctuation">}</span><span class="error">_ma</span><span class="punctuation">]</span>&nbsp;<span class="operator">=</span>&nbsp;<span class="variable">df</span><span class="punctuation">[</span><span class="string">'Close'</span><span class="punctuation">]</span><span class="error"></span><span class="variable">rolling</span><span class="punctuation">(</span><span class="variable">fast</span><span class="punctuation">)</span><span class="error"></span><span class="variable">mean</span><span class="punctuation">(</span><span class="punctuation">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="variable">df</span><span class="punctuation">[</span><span class="error">f</span><span class="punctuation">{</span><span class="variable">SLOW</span><span class="punctuation">}</span><span class="error">_ma</span><span class="punctuation">]</span>&nbsp;<span class="operator">=</span>&nbsp;<span class="variable">df</span><span class="punctuation">[</span><span class="string">'Close'</span><span class="punctuation">]</span><span class="error"></span><span class="variable">rolling</span><span class="punctuation">(</span><span class="variable">slow</span><span class="punctuation">)</span><span class="error"></span><span class="variable">mean</span><span class="punctuation">(</span><span class="punctuation">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="error">plt</span><span class="variable">plot</span><span class="punctuation">(</span><span class="variable">df</span><span class="punctuation">[</span><span class="string">'Close'</span><span class="punctuation">]</span><span class="punctuation">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="error">plt</span><span class="variable">plot</span><span class="punctuation">(</span><span class="variable">df</span><span class="punctuation">[</span><span class="error">f</span><span class="punctuation">{</span><span class="variable">FAST</span><span class="punctuation">}</span><span class="error">_ma</span><span class="punctuation">]</span><span class="punctuation">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="error">plt</span><span class="variable">plot</span><span class="punctuation">(</span><span class="variable">df</span><span class="punctuation">[</span><span class="error">f</span><span class="punctuation">{</span><span class="variable">SLOW</span><span class="punctuation">}</span><span class="error">_ma</span><span class="punctuation">]</span><span class="punctuation">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="error">plt</span><span class="variable">legend</span><span class="punctuation">(</span><span class="punctuation">[</span><span class="string">'Close'</span><span class="punctuation">,</span>&nbsp;<span class="error">f</span><span class="punctuation">{</span><span class="variable">FAST</span><span class="punctuation">}</span><span class="error">_ma</span><span class="punctuation">,</span>&nbsp;<span class="error">f</span><span class="punctuation">{</span><span class="variable">SLOW</span><span class="punctuation">}</span><span class="error">_ma</span><span class="punctuation">]</span><span class="punctuation">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="error">plt</span><span class="variable">title</span><span class="punctuation">(</span><span class="string">'Moving Avgs CrssOvrs '</span><span class="operator">+</span>&nbsp;<span class="variable">TICKER</span>&nbsp;<span class="punctuation">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="error">df</span><span class="variable">dropna</span><span class="punctuation">(</span><span class="punctuation">)</span><br><br><span class="keyword">def</span>&nbsp;<span class="variable">addStrat</span><span class="punctuation">(</span><span class="variable">df</span><span class="punctuation">,</span>&nbsp;<span class="variable">fast</span><span class="punctuation">,</span><span class="variable">slow</span><span class="punctuation">)</span><span class="punctuation">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="variable">df</span><span class="punctuation">[</span><span class="string">'Strategy'</span><span class="punctuation">]</span>&nbsp;<span class="operator">=</span>&nbsp;<span class="error">np</span><span class="variable">where</span><span class="punctuation">(</span><span class="variable">df</span><span class="punctuation">[</span><span class="error">f</span><span class="punctuation">{</span><span class="variable">fast</span><span class="punctuation">}</span><span class="error">_ma</span><span class="punctuation">]</span>&nbsp;<span class="operator">></span>&nbsp;<span class="variable">df</span><span class="punctuation">[</span><span class="error">f</span><span class="punctuation">{</span><span class="variable">slow</span><span class="punctuation">}</span><span class="error">_ma</span><span class="punctuation">]</span><span class="punctuation">,</span>&nbsp;<span class="number">1</span><span class="punctuation">,</span>&nbsp;<span class="operator">-</span><span class="number">1</span><span class="punctuation">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="variable">df</span><span class="punctuation">[</span><span class="string">'Strategy'</span><span class="punctuation">]</span>&nbsp;<span class="operator">=</span>&nbsp;<span class="variable">df</span><span class="punctuation">[</span><span class="string">'Strategy'</span><span class="punctuation">]</span><span class="error"></span><span class="variable">shift</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="variable">df</span><br><br><br><span class="keyword">def</span>&nbsp;<span class="variable">testStrat</span><span class="punctuation">(</span><span class="variable">df</span><span class="punctuation">,</span>&nbsp;<span class="variable">ticker</span><span class="punctuation">,</span>&nbsp;<span class="variable">fast</span><span class="punctuation">,</span>&nbsp;<span class="variable">slow</span><span class="punctuation">)</span><span class="punctuation">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="variable">df</span><span class="punctuation">[</span><span class="string">'Asset Returns'</span><span class="punctuation">]</span>&nbsp;<span class="operator">=</span>&nbsp;<span class="punctuation">(</span><span class="number">1</span>&nbsp;<span class="operator">+</span>&nbsp;<span class="variable">df</span><span class="punctuation">[</span><span class="string">'Close'</span><span class="punctuation">]</span><span class="error"></span><span class="variable">pct_change</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="error"></span><span class="variable">cumprod</span><span class="punctuation">(</span><span class="punctuation">)</span>&nbsp;<span class="operator">-</span><span class="number">1</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="variable">df</span><span class="punctuation">[</span><span class="string">'Strategy Returns'</span><span class="punctuation">]</span>&nbsp;<span class="operator">=</span>&nbsp;<span class="punctuation">(</span><span class="number">1</span>&nbsp;<span class="operator">+</span>&nbsp;<span class="variable">df</span><span class="punctuation">[</span><span class="string">'Close'</span><span class="punctuation">]</span><span class="error"></span><span class="variable">pct_change</span><span class="punctuation">(</span><span class="punctuation">)</span>&nbsp;<span class="operator">*</span>&nbsp;<span class="variable">df</span><span class="punctuation">[</span><span class="string">'Strategy'</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="error"></span><span class="variable">cumprod</span><span class="punctuation">(</span><span class="punctuation">)</span>&nbsp;<span class="operator">-</span>&nbsp;<span class="number">1</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="error">plt</span><span class="variable">figure</span><span class="punctuation">(</span><span class="punctuation">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="error">plt</span><span class="variable">plot</span><span class="punctuation">(</span><span class="variable">df</span><span class="punctuation">[</span><span class="string">'Asset Returns'</span><span class="punctuation">]</span><span class="punctuation">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="error">plt</span><span class="variable">plot</span><span class="punctuation">(</span><span class="variable">df</span><span class="punctuation">[</span><span class="string">'Strategy Returns'</span><span class="punctuation">]</span><span class="punctuation">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="error">plt</span><span class="variable">legend</span><span class="punctuation">(</span><span class="punctuation">[</span><span class="error">f</span><span class="punctuation">{</span><span class="variable">ticker</span><span class="punctuation">}</span>&nbsp;<span class="variable">Cumulative</span>&nbsp;<span class="error">Returns</span><span class="punctuation">,</span>&nbsp;<span class="error">f</span><span class="punctuation">{</span><span class="variable">fast</span><span class="punctuation">}</span>&nbsp;<span class="operator">-</span>&nbsp;<span class="punctuation">{</span><span class="variable">slow</span><span class="punctuation">}</span>&nbsp;<span class="variable">Crossover</span>&nbsp;<span class="variable">Strategy</span>&nbsp;<span class="error">Returns</span><span class="punctuation">]</span><span class="punctuation">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="error">plt</span><span class="variable">title</span><span class="punctuation">(</span><span class="string">'Moving Average Crossovers '</span>&nbsp;<span class="operator">+</span>&nbsp;<span class="variable">TICKER</span><span class="punctuation">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="error">plt</span><span class="variable">show</span><span class="punctuation">(</span><span class="punctuation">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="error">df</span><span class="variable">dropna</span><span class="punctuation">(</span><span class="punctuation">)</span><br><br><br><span class="variable">df</span>&nbsp;<span class="operator">=</span>&nbsp;<span class="error">yf</span><span class="variable">download</span><span class="punctuation">(</span><span class="variable">TICKER</span><span class="punctuation">)</span><br><span class="variable">df</span>&nbsp;<span class="operator">=</span>&nbsp;<span class="variable">getData</span><span class="punctuation">(</span><span class="punctuation">)</span><br><span class="variable">df</span>&nbsp;<span class="operator">=</span>&nbsp;<span class="variable">addMovingAverages</span><span class="punctuation">(</span><span class="variable">df</span><span class="punctuation">,</span>&nbsp;<span class="variable">FAST</span><span class="punctuation">,</span>&nbsp;<span class="variable">SLOW</span><span class="punctuation">)</span><br><span class="variable">df</span>&nbsp;<span class="operator">=</span>&nbsp;<span class="variable">addStrat</span><span class="punctuation">(</span><span class="variable">df</span><span class="punctuation">,</span>&nbsp;<span class="variable">FAST</span><span class="punctuation">,</span>&nbsp;<span class="variable">SLOW</span><span class="punctuation">)</span><br><span class="variable">df</span>&nbsp;<span class="operator">=</span>&nbsp;<span class="variable">testStrat</span><span class="punctuation">(</span><span class="variable">df</span><span class="punctuation">,</span>&nbsp;<span class="variable">TICKER</span><span class="punctuation">,</span>&nbsp;<span class="variable">FAST</span><span class="punctuation">,</span>&nbsp;<span class="variable">SLOW</span><span class="punctuation">)</span><br><span class="keyword">print</span><span class="punctuation">(</span><span class="variable">df</span><span class="punctuation">)</span></pre></body></html>